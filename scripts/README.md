# üõ†Ô∏è Scripts utilitaires TicTacToe

Ce dossier contient les scripts pour configurer et calibrer le syst√®me TicTacToe.

---

## üìù Liste des scripts

### 1. `convert_models_for_cpu.py` ‚≠ê **√Ä ex√©cuter en premier**

**But :** Convertir les mod√®les EdgeTPU en mod√®les compatibles CPU

**Usage :**
```bash
# Sur votre PC de d√©veloppement (PAS sur Reachy)
python scripts/convert_models_for_cpu.py
```

**Ce qu'il fait :**
- ‚úÖ Cr√©e de nouveaux mod√®les TFLite bas√©s sur MobileNetV2
- ‚úÖ Sauvegarde les anciens mod√®les EdgeTPU en backup
- ‚úÖ Teste la compatibilit√© CPU
- ‚úÖ Utilise le transfer learning (pr√©-entra√Æn√© sur ImageNet)

**R√©sultat :**
- `reachy_tictactoe/models/ttt-boxes.tflite` (nouveau, ~9 MB)
- `reachy_tictactoe/models/ttt-valid-board.tflite` (nouveau, ~9 MB)

**‚ö†Ô∏è Important :** Ces mod√®les doivent √™tre entra√Æn√©s avec vos propres donn√©es pour une d√©tection pr√©cise. Le script cr√©e l'architecture de base avec transfer learning.

---

### 2. `calibrate_board.py` üéØ **√Ä ex√©cuter sur Reachy**

**But :** D√©terminer les coordonn√©es pr√©cises de chaque case du plateau

**Usage :**
```bash
# Sur Reachy
python scripts/calibrate_board.py --host localhost

# Ou en test avec une image existante (sur PC)
python scripts/calibrate_board.py --image /path/to/board_image.jpg
```

**Ce qu'il fait :**
1. Capture une image depuis la cam√©ra de Reachy
2. Affiche une interface graphique
3. Vous permet de tracer des rectangles autour de chaque case
4. G√©n√®re le code Python pour `vision.py`
5. Sauvegarde les coordonn√©es dans `/tmp/board_calibration.py`

**Interface interactive :**
- üñ±Ô∏è Cliquez et glissez pour tracer un rectangle
- ‚å®Ô∏è 's' = sauvegarder
- ‚å®Ô∏è 'r' = recommencer
- ‚å®Ô∏è 'q' = quitter

**Ordre des cases :**
```
(0,0) -> (0,1) -> (0,2)
(1,0) -> (1,1) -> (1,2)
(2,0) -> (2,1) -> (2,2)
```

---

### 3. `create_fallback_models.py` üîß **Obsol√®te - Utilisez convert_models_for_cpu.py**

**But :** Cr√©er des mod√®les de remplacement simples (placeholders)

**‚ö†Ô∏è Attention :** Ce script cr√©e des mod√®les qui ne d√©tectent PAS vraiment les pi√®ces. Il est uniquement pour tester que le syst√®me fonctionne sans EdgeTPU.

**Usage :**
```bash
python scripts/create_fallback_models.py
```

**Quand l'utiliser :**
- Seulement si `convert_models_for_cpu.py` ne fonctionne pas
- Pour des tests rapides du syst√®me (sans d√©tection r√©elle)

---

## üöÄ Flux de travail recommand√©

### Pr√©paration (sur PC de dev)

```bash
cd /home/mia/Bureau/reachy-2019-tictactoe

# 1. Convertir les mod√®les
python scripts/convert_models_for_cpu.py

# 2. V√©rifier la cr√©ation des mod√®les
ls -lh reachy_tictactoe/models/*.tflite
```

### Transfert vers Reachy

```bash
# 3. Transf√©rer le projet complet
scp -r reachy-2019-tictactoe reachy@<IP_REACHY>:~/

# Ou seulement les fichiers n√©cessaires
scp -r reachy_tictactoe reachy@<IP>:~/reachy-2019-tictactoe/
scp -r scripts reachy@<IP>:~/reachy-2019-tictactoe/
```

### Configuration (sur Reachy)

```bash
# 4. Se connecter √† Reachy
ssh reachy@<IP_REACHY>

# 5. Installer le projet
cd ~/reachy-2019-tictactoe
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install -e .

# 6. Calibrer les coordonn√©es
python scripts/calibrate_board.py --host localhost

# 7. Mettre √† jour vision.py avec les coordonn√©es
nano reachy_tictactoe/vision.py
# Copier-coller les coordonn√©es g√©n√©r√©es

# 8. Tester le syst√®me
python -m reachy_tictactoe.game_launcher --log-file /tmp/tictactoe
```

---

## üìã Checklist de d√©ploiement

- [ ] ‚úÖ Mod√®les convertis pour CPU (`convert_models_for_cpu.py`)
- [ ] ‚úÖ Projet transf√©r√© sur Reachy
- [ ] ‚úÖ Environnement virtuel cr√©√© et activ√©
- [ ] ‚úÖ D√©pendances install√©es
- [ ] ‚úÖ Coordonn√©es calibr√©es (`calibrate_board.py`)
- [ ] ‚úÖ `vision.py` mis √† jour avec les nouvelles coordonn√©es
- [ ] ‚úÖ Test de vision r√©ussi
- [ ] ‚úÖ Premier jeu lanc√©

---

## üêõ D√©pannage des scripts

### Erreur : "No module named 'tensorflow'"

```bash
# Sur PC
pip install tensorflow

# Sur Reachy (dans venv)
source venv/bin/activate
pip install tensorflow
```

### Erreur : "No module named 'reachy_sdk'"

```bash
# Sur Reachy
source venv/bin/activate
pip install reachy-sdk
```

### Erreur : "cv2.error" lors de la calibration

```bash
# Installer OpenCV
pip install opencv-python
```

### Calibration : La fen√™tre ne s'affiche pas

**Sur Reachy en SSH :**
```bash
# Activer le forwarding X11
ssh -X reachy@<IP>
python scripts/calibrate_board.py --host localhost
```

**Alternative :** Utiliser une image de test
```bash
# Capturer une image manuellement
python -c "
from reachy_sdk import ReachySDK
import cv2, time

r = ReachySDK('localhost')
r.turn_on('head')
r.head.look_at(x=0.5, y=0, z=-0.6, duration=1.0)
time.sleep(1.5)

img = r.right_camera.last_frame
cv2.imwrite('/tmp/board_test.jpg', img)
print('Image sauvegard√©e: /tmp/board_test.jpg')
"

# Transf√©rer l'image sur votre PC
scp reachy@<IP>:/tmp/board_test.jpg .

# Calibrer localement
python scripts/calibrate_board.py --image board_test.jpg
```

---

## üìö Ressources

- **Guide complet de d√©ploiement :** `../GUIDE_DEPLOYMENT.md`
- **Conversion EdgeTPU :** `../EDGE_TPU_CONVERSION.md`
- **D√©marrage rapide :** `../QUICK_START.md`
- **README principal :** `../README.md`

---

## ‚ùì Questions fr√©quentes

### Q: Dois-je ex√©cuter ces scripts √† chaque fois ?

**R:** Non, seulement lors de la configuration initiale :
- `convert_models_for_cpu.py` : Une seule fois (ou si vous changez de mod√®les)
- `calibrate_board.py` : Une seule fois (ou si vous d√©placez le plateau/cam√©ra)

### Q: Puis-je am√©liorer la pr√©cision des mod√®les ?

**R:** Oui ! Entra√Ænez-les avec vos propres donn√©es :
1. Collectez des images avec `notebooks/Collect_training_images.ipynb`
2. Entra√Ænez avec `notebooks/Train_classifier.ipynb`
3. Remplacez les mod√®les dans `reachy_tictactoe/models/`

### Q: Les mod√®les CPU sont-ils assez rapides ?

**R:** Oui, largement suffisant pour le jeu de morpion :
- CPU i5/i7 : ~30-100ms par inf√©rence
- EdgeTPU : ~5-10ms
- Pour un jeu au tour par tour, aucune diff√©rence perceptible

### Q: Puis-je utiliser ces scripts pour d'autres projets ?

**R:** Oui ! Ils sont con√ßus pour √™tre r√©utilisables :
- `convert_models_for_cpu.py` : Adaptez pour vos propres mod√®les
- `calibrate_board.py` : Modifiez pour d'autres types de grilles/zones

---

## ü§ù Contributions

Am√©liorations bienvenues :
- Ajout de tests automatiques
- Support pour d'autres architectures (EfficientNet, etc.)
- Interface de calibration am√©lior√©e
- Script de validation automatique

---

**Besoin d'aide ?** Consultez `../GUIDE_DEPLOYMENT.md` pour le guide complet !

